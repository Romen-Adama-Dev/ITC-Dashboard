<div class="gridster-container">
  <div class="controls">
    <app-primary-button
      nzSize="default"
      (click)="openCustomModal()"
      (keydown.enter)="openCustomModal()"
      tabindex="0">
      {{ 'ADD' | translate }}
    </app-primary-button>
  
    <app-default-button
      nzSize="default"
      (click)="changedOptions()"
      (keydown.enter)="changedOptions()"
      [disabled]="!pushItemsEnabled"
      tabindex="0">
      {{ 'CLEAN_UP' | translate }}
    </app-default-button>
  
    <app-default-button
      nzSize="default"
      (click)="togglePushItems()"
      (keydown.enter)="togglePushItems()"
      [ngClass]="{ 'hover-style': !pushItemsEnabled }"
      tabindex="0">
      {{ pushItemsEnabled
         ? ('LOCK_WIDGETS' | translate)
         : ('UNLOCK_WIDGETS' | translate)
      }}
    </app-default-button>
  
    <app-default-button
      nzSize="default"
      (click)="serializeToJson()"
      (keydown.enter)="serializeToJson()"
      tabindex="0">
      {{ 'SERIALIZE' | translate }}
    </app-default-button>
  
    <input
      type="file"
      #loadJsonInput
      hidden
      (change)="loadJsonFromFile($event)"
    />
    <app-default-button
      nzSize="default"
      (click)="loadJsonInput.click()"
      (keydown.enter)="loadJsonInput.click()"
      tabindex="0">
      {{ 'LOAD_JSON' | translate }}
    </app-default-button>
  
    <input
      type="file"
      #deserializeInput
      hidden
      (change)="deserializeFromFile($event)"
    />
    <app-default-button
      nzSize="default"
      (click)="deserializeInput.click()"
      (keydown.enter)="deserializeInput.click()"
      tabindex="0">
      {{ 'DESERIALIZE_JSON' | translate }}
    </app-default-button>
  
    <app-language-dropdown
      [languages]="languages"
      [selectedLanguage]="selectedLanguage"
      (languageChange)="onLanguageChange($event)">
    </app-language-dropdown>
  
    <app-theme-toggle-button
      [currentTheme]="currentTheme"
      (toggleTheme)="onToggleTheme()"
      class="theme-toggle-wrapper">
    </app-theme-toggle-button>
  </div>
  
  <gridster class="gridster-wrapper" [options]="options">
    <gridster-item *ngFor="let item of dashboard; trackBy: trackByFn" [item]="item">
      <div class="grid-item-content">
        <div class="item-content">
          <ng-container *ngIf="item.chartType === 'line-chart'">
            <app-line-chart></app-line-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'advanced-pie-chart'">
            <app-advanced-pie-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-advanced-pie-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'area-chart'">
            <app-area-chart 
            [dataSource]="item.dataSource || ''"
            [dataCount]="item.dataCount || ''">
            ></app-area-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'box-chart'">
            <app-box-chart
            [dataSource]="item.dataSource || ''"
            [dataCount]="item.dataCount || ''">
            ></app-box-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'bubble-chart'">
            <app-bubble-chart
            [dataSource]="item.dataSource || ''"
            [dataCount]="item.dataCount || ''">
            </app-bubble-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'gauge-chart'">
            <app-gauge-chart
            [dataSource]="item.dataSource || ''"
            [dataCount]="item.dataCount || ''">
            </app-gauge-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'heat-map'">
            <app-heat-map
            [dataSource]="item.dataSource || ''"
            [dataCount]="item.dataCount || ''">
            </app-heat-map>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'horizontal-bar'">
            <app-horizontal-bar-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-horizontal-bar-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'line-chart'">
            <app-horizontal-bar-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-horizontal-bar-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'linear-gauge-chart'">
            <app-linear-gauge-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-linear-gauge-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'normalized-area-chart'">
            <app-normalized-area-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-normalized-area-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'normalized-horizontal-chart'">
            <app-normalized-horizontal-bar-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-normalized-horizontal-bar-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'normalized-vertical-chart'">
            <app-normalized-vertical-bar-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
          </app-normalized-vertical-bar-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'number-chart'">
            <app-number-cards
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
          </app-number-cards>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'percent-gauge-chart'">
            <app-percent-gauge-chart
            [dataSource]="item.dataSource || ''">
          </app-percent-gauge-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'pie-chart'">
            <app-pie-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
          </app-pie-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'pie-grid-chart'">
            <app-pie-grid
            [dataSource]="item.dataSource || ''"
            [dataCount]="item.dataCount || ''">
            </app-pie-grid>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'polar-chart'">
            <app-polar-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-polar-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'stacked-area-chart'">
            <app-stacked-area-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-stacked-area-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'stacked-horizontal-bar-chart'">
            <app-stacked-horizontal-bar-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-stacked-horizontal-bar-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'stacked-vertical-bar-chart'">
            <app-stacked-vertical-bar-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-stacked-vertical-bar-chart>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'tree-map'">
            <app-tree-map
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-tree-map>
          </ng-container>
          <ng-container *ngIf="item.chartType === 'vertical-bar'">
            <app-vertical-chart
              [dataSource]="item.dataSource || ''"
              [dataCount]="item.dataCount || ''">
            </app-vertical-chart>
          </ng-container>
        </div>
        <div class="item-buttons">
          <div class="shape-float-container edit-button">
            <app-float-shape-button
              shape="circle"
              nzType="primary"
              icon="edit"
              iconTheme="outline"
              [disabled]="!pushItemsEnabled"
              (nzOnClick)="editItem(item)">
            </app-float-shape-button>
          </div>
          <div class="shape-float-container delete-button">
            <app-float-shape-button
              shape="circle"
              nzType="primary"
              icon="close"
              iconTheme="outline"
              [disabled]="!pushItemsEnabled"
              (nzOnClick)="removeItem(item)">
            </app-float-shape-button>
          </div>
        </div>
      </div>
    </gridster-item>
  </gridster>
  
  <app-chart-selection-modal
    [isVisible]="isModalVisible"
    (selectedChartType)="selectedChartType"
    (addChart)="onAddChart($event)"
    (closeModal)="closeCustomModal()">
  </app-chart-selection-modal>
  
  <app-edit-widget-modal
    [isVisible]="isEditModalVisible"
    [dataCount]="currentEditItem?.['dataCount'] || 'all'"
    [dataSource]="currentEditItem?.['dataSource'] || '/assets/data-set-1.json'"
    (save)="handleWidgetEditSave($event)"
    (close)="handleEditModalClose()">
  </app-edit-widget-modal>
</div>